<!doctype html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;600&family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>1,000 Bottles of Wine - richardharris.github.io</title>
<meta name="description" content=""/>
<meta name="author" content="Richard Harris"/>
<meta name="copyright" content="Richard Harris (c) "/>
<link rel="stylesheet" href="/static/css/foundation.css"/>
<link rel="stylesheet" href="/static/css/site.css"/>
<link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
<link rel="manifest" href="/static/site.webmanifest">
</head>
<body>

<div class="row">
<div class="large-12 columns">
<div class="nav-bar right">
<ul class="button-group">
<li><a href="/" class="button">Home</a></li>
<li><a href="/about/" class="button">About</a></li>
<li><a href="/featured/" class="button">Featured</a></li>
</ul>
</div>
<h1><a href="/" class="logo">
richardjharris</a><small>.github.io</small></h1>
<hr/>
</div>
</div>


<div class="row">

<div class="large-9 columns" role="content">

<article>
<h1><a href="#">1,000 Bottles of Wine</a></h1>
<p class="article-date">
    25<sup>th</sup> April 2022</sup> 
    &middot; 2 min read
</p>
<p>So there&rsquo;s this king. Someone breaks into his wine cellar which stores
1,000 bottles of wine. This person proceeds to poison one of the
1,000 bottles, but gets away too quickly for the king&rsquo;s guard to see
which one he poisoned or to catch him.</p>
<p>The king needs the remaining 999 safe bottles for his party in four weeks.
The king has 10 servants who he considers disposable. The poison takes
about 3 weeks to take effect, and any amount of it will kill whoever
drinks it. How can he figure out which bottle was poisoned in time for
the party?</p>
<h2>Solving the problem</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">Wine</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poisoned</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="nf">poison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poisoned</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">Servant</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dead</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">drink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wine</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dead</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">wine</span><span class="o">.</span><span class="n">poisoned</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Arghhh! &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; has died!&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dead</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">servants</span> <span class="o">=</span> <span class="p">[</span><span class="n">Servant</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
    <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;Steve&quot;</span><span class="p">,</span> <span class="s2">&quot;Mr. Chips&quot;</span><span class="p">,</span> <span class="s2">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="s2">&quot;Suzuki&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Anthony&quot;</span><span class="p">,</span> <span class="s2">&quot;Marshmallow&quot;</span><span class="p">,</span> <span class="s2">&quot;Toshino&quot;</span><span class="p">,</span> <span class="s2">&quot;Bumblesocks&quot;</span><span class="p">,</span> <span class="s2">&quot;Monkey D. Luffy&quot;</span><span class="p">,</span>
<span class="p">]]</span>

<span class="n">wines</span> <span class="o">=</span> <span class="p">[</span><span class="n">Wine</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="c1"># Poison a random wine</span>
<span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">wines</span><span class="p">)</span><span class="o">.</span><span class="n">poison</span><span class="p">()</span>

<span class="c1"># The trick is that we assign a binary number to each wine. This number&#39;s</span>
<span class="c1"># 0s and 1s map to a unique combination of servants who will drink that wine.</span>
<span class="c1">#  (Each servant will drink a lot of wines)</span>
<span class="c1"># After 3 weeks, if that exact combination of servants die, we know which</span>
<span class="c1"># wine contained the poison.</span>

<span class="c1"># Consider a simpler example with 2 servants and 4 wines.</span>
<span class="c1">#  Wine 0 - don&#39;t give to anyone</span>
<span class="c1">#  Wine 1 - give to servant A</span>
<span class="c1">#  Wine 2 - give to servant B</span>
<span class="c1">#  Wine 3 - give to both servants</span>
<span class="c1">#</span>
<span class="c1"># After 3 weeks, if nobody dies, the poison must be in Wine 0. If A dies,</span>
<span class="c1"># it&#39;s Wine 1. If B dies, Wine 2. If they both die, Wine 3.</span>
<span class="c1">#</span>
<span class="c1"># Mathematically speaking, each servant represents a bit of information</span>
<span class="c1"># (alive/dead) and 10 servants can represent 10 bits or 2^10 (1024) states.</span>
<span class="c1"># Thus we can actually check up to 1,024 wines using this method.</span>
<span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">wine</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wines</span><span class="p">):</span>
    <span class="c1"># enumerate(wines) gives us a numbering from 0 to 999. We then convert</span>
    <span class="c1"># to binary.</span>
    <span class="c1"># The first wine is 0 (binary 0000000000) - nobody drinks it.</span>
    <span class="c1"># The second is 1 (binary 0000000001). Reading from right to left, only</span>
    <span class="c1">#  the first servant will drink it.</span>
    <span class="c1"># The last wine 999 is 1111101000 in binary. Reading from right to</span>
    <span class="c1"># left, servants 4,6,7,8,9 and 10 will drink it.</span>
    <span class="n">to_feed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{0:b}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
    <span class="n">to_feed</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">servant</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">servants</span><span class="p">,</span> <span class="n">to_feed</span><span class="p">):</span>
        <span class="n">servant</span><span class="o">.</span><span class="n">drink</span><span class="p">(</span><span class="n">wine</span><span class="p">)</span>

<span class="c1"># Now get the positions of our dead servants</span>
<span class="n">dead</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">servant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">servants</span><span class="p">)</span> <span class="k">if</span> <span class="n">servant</span><span class="o">.</span><span class="n">dead</span><span class="p">]</span>
<span class="c1"># Convert back from binary to decimal to get the wine number.</span>
<span class="n">poisoned_number</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dead</span><span class="p">)</span>
<span class="n">poisoned</span> <span class="o">=</span> <span class="n">wines</span><span class="p">[</span><span class="n">poisoned_number</span><span class="p">]</span>
<span class="c1"># Now check if we were right.</span>
<span class="n">jim</span> <span class="o">=</span> <span class="n">Servant</span><span class="p">(</span><span class="s2">&quot;Guinea Pig&quot;</span><span class="p">)</span>
<span class="n">jim</span><span class="o">.</span><span class="n">drink</span><span class="p">(</span><span class="n">poisoned</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">jim</span><span class="o">.</span><span class="n">dead</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HUZZAH! Correctly identified poisoned wine </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">poisoned_number</span><span class="p">)</span>
</code></pre></div>
</article>

</div>


<aside class="large-3 columns sidebar">
<div class="panel">
<h5>First time here?</h5>
<p>Have a look at my <a href="/featured/">featured articles</a>.</p>
</div>
<h5>Categories</h5>
<ul class="side-nav">

<li><a href="/category/Japanese/">Japanese</a></li>

<li><a href="/category/Programming/">Programming</a></li>

<li><a href="/category/Wellbeing/">Wellbeing</a></li>

</ul>
<h5>Tags</h5>
<ul class="side-nav taglist">

<li><a href="/tag/programming/" data-count="8">programming (8)</a></li>

<li><a href="/tag/japanese/" data-count="7">japanese (7)</a></li>

<li><a href="/tag/perl/" data-count="7">perl (7)</a></li>

<li><a href="/tag/featured/" data-count="4">featured (4)</a></li>

<li><a href="/tag/unicode/" data-count="2">unicode (2)</a></li>

<li><a href="/tag/pbp/" data-count="2">pbp (2)</a></li>

<li><a href="/tag/dart/" data-count="1">dart (1)</a></li>

<li><a href="/tag/problems/" data-count="1">problems (1)</a></li>

<li><a href="/tag/python/" data-count="1">python (1)</a></li>

<li><a href="/tag/wellbeing/" data-count="1">wellbeing (1)</a></li>

<li><a href="/tag/book-summary/" data-count="1">book-summary (1)</a></li>

<li><a href="/tag/productivity/" data-count="1">productivity (1)</a></li>

<li><a href="/tag/faq/" data-count="1">faq (1)</a></li>

<li><a href="/tag/gotcha/" data-count="1">gotcha (1)</a></li>

<li><a href="/tag/heatmap/" data-count="1">heatmap (1)</a></li>

<li><a href="/tag/cpan/" data-count="1">cpan (1)</a></li>

<li><a href="/tag/git/" data-count="1">git (1)</a></li>

<li><a href="/tag/datetime/" data-count="1">datetime (1)</a></li>

<li><a href="/tag/stackoverflow/" data-count="1">stackoverflow (1)</a></li>

</ul>
</a>
<h5>Other sites</h5>
<ul class="side-nav taglist">
<li><a href="https://github.com/richardjharris">GitHub</a></li>
</ul>
<div class="text-center">
<!-- stackoverflow badge. slow so lazy-load it -->
<a href="https://stackoverflow.com/users/74496/rjh">
<img id="stack" data-original="https://stackoverflow.com/users/flair/74496.png"
    width="208" height="58" alt="Link to stackoverflow profile"
    title="stackoverflow profile">
    <noscript>
    <img src="https://stackoverflow.com/users/flair/74496.png"
    width="208" height="58" alt="Link to stackoverflow profile"
    title="stackoverflow profile">
    </noscript>
</a>
<!-- end badge -->
</div>
</aside>

</div>

<footer class="row">
<div class="large-12 columns">
<hr/>
<div class="row">
<div class="large-6 columns">
<p>&copy; Richard Harris 2022.</p>
</div>
<div class="large-6 columns">
<p class="right">
Made with <a href="https://foundation.zurb.com/">Foundation</a> and <a href="https://flask.palletsprojects.com/en/2.1.x/">Flask</a>.
</p>
</div>
</div>
</div>
</footer>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/jquery.qtip.min.css" />
<script src="/static/js/vendor/jquery.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/basic/jquery.qtip.min.js"></script>
<script src="/static/js/unicode-tooltips.js"></script>
<script>
      $(document).ready(function(){
        $('.unichar').each(add_unicode_tooltip);
        $('.an').each(add_annotation_tooltip);
        // For debugging tooltip HTML
        // $('.an').each(function() { $(this).qtip('toggle', true); });

        $('#stack').attr('src', $('#stack').data('original'));
      });
    </script>
</body>
</html>