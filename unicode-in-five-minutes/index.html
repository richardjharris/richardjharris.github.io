<!doctype html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;600&family=IBM+Plex+Sans:wght@400;600&display=swap" rel="stylesheet">

<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Unicode In Five Minutes ⌚ - richardharris.github.io</title>
<meta name="description" content=""/>
<meta name="author" content="Richard Harris"/>
<meta name="copyright" content="Richard Harris (c) "/>
<link rel="stylesheet" href="/static/css/foundation.css"/>
<link rel="stylesheet" href="/static/css/site.css"/>
<link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
<link rel="manifest" href="/static/site.webmanifest">
</head>
<body>

<div class="row">
<div class="large-12 columns">
<div class="nav-bar right">
<ul class="button-group">
<li><a href="/" class="button">Home</a></li>
<li><a href="/about/" class="button">About</a></li>
<li><a href="/featured/" class="button">Featured</a></li>
</ul>
</div>
<h1><a href="/" class="logo">
richardjharris</a><small>.github.io</small></h1>
<hr/>
</div>
</div>


<div class="row">

<div class="large-9 columns" role="content">

<article>
<h1><a href="#">Unicode In Five Minutes ⌚</a></h1>
<p class="article-date">
    4<sup>th</sup> December 2013</sup> 
    &middot; 10 min read
</p>
<h2>Why</h2>
<p>One encoding covering <em>most</em> of the world&rsquo;s writing systems. Standard
encoding of the web, most operating systems, Java and .NET.</p>
<p>Before Unicode, each script (or script family) had its own encoding, or
worse, lots of different incompatible encodings. Unicode is a superset
of almost all of them, so can be used for interchange.</p>
<p>It&rsquo;s been around for <a href="https://www.unicode.org/history/unicode88.pdf">over 30 years</a>.</p>
<p><em>Note: code examples are Perl-centric so far, because it has really good Unicode
support and I know it; if you have examples for other languages, please do post
a comment!</em></p>
<h2>What</h2>
<p style="text-align: center"><img alt="Unicode character examples" src="/static/images/unichar-examples.png" /></p>
<p>Unicode defines a <em>code point</em> (number) for every character, such as <span><span class="unichar" data-code="0061" data-name="LATIN SMALL LETTER A" title="LATIN SMALL LETTER A (U+0061)">a</span></span>, <span><span class="unichar" data-code="00E3" data-name="LATIN SMALL LETTER A WITH TILDE" title="LATIN SMALL LETTER A WITH TILDE (U+00E3)">ã</span></span>,
<span><span class="unichar" data-code="06D0" data-name="ARABIC LETTER E" title="ARABIC LETTER E (U+06D0)">ې</span></span>, <span><span class="unichar" data-code="4E0D" data-name="CJK UNIFIED IDEOGRAPH-4E0D" title="CJK UNIFIED IDEOGRAPH-4E0D (U+4E0D)">不</span></span> and <span><span class="unichar" data-code="2603" data-name="SNOWMAN" title="SNOWMAN (U+2603)">☃</span></span>. As of <a href="https://www.unicode.org/versions/Unicode6.2.0/">Unicode 6.2</a> there are <strong>109,976</strong> code points!</p>
<div class="panel callout radius">
<p>You can mouseover any highlighted character for more information!</p>
</div>

<p>It also includes <em>combining characters</em> such as <span><span class="unichar" data-code="0300" data-name="COMBINING GRAVE ACCENT" title="COMBINING GRAVE ACCENT (U+0300)">◌̀</span></span> which can be added to
other characters; this way, Unicode does not need a code point for every possible
combination of letter and accent. On the other hand, Unicode <em>generally</em> doesn&rsquo;t care
about fonts or stylistic differences: it gives <img alt="a (double-story)" src="/static/images/a1.png" style="vertical-align: bottom; border: none" />
and <img alt="a (single-story)" src="/static/images/a2.png" style="vertical-align: bottom; border: none" /> the same codepoint.</p>
<p>It&rsquo;s <em>more than just a character set</em>: it also covers standard encodings such
as UTF-8; <nobr>lower/upper/title</nobr> case mapping; collation (sorting); line breaks;
rendering; right-to-left script handling, and more.</p>
<h2>Normalization</h2>
<p>For compatibility with other encodings Unicode sometimes includes <em>precomposed</em>
versions of characters, for example, these three:</p>
<ul>
<li><span><span class="unichar" data-code="00C5" data-name="LATIN CAPITAL LETTER A WITH RING ABOVE" title="LATIN CAPITAL LETTER A WITH RING ABOVE (U+00C5)">Å</span><span> LATIN CAPITAL LETTER A WITH RING ABOVE (U+00C5)</span></span></li>
<li><span><span class="unichar" data-code="212B" data-name="ANGSTROM SIGN" title="ANGSTROM SIGN (U+212B)">Å</span><span> ANGSTROM SIGN (U+212B)</span></span></li>
<li><span><span class="unichar" data-code="0041" data-name="LATIN CAPITAL LETTER A" title="LATIN CAPITAL LETTER A (U+0041)">A</span><span> LATIN CAPITAL LETTER A (U+0041)</span></span> + <span><span class="unichar" data-code="030A" data-name="COMBINING RING ABOVE" title="COMBINING RING ABOVE (U+030A)">◌̊</span><span> COMBINING RING ABOVE (U+030A)</span></span></li>
</ul>
<p>For these to be treated as the same string in equality tests etc. you should
run all input through <a href="https://unicode.org/reports/tr15/">Unicode normalisation</a>. The most common form is
<abbr title="Normalisation Form C (canonical decomposition + canonical composition)">NFC</abbr>, which uses pre<strong>C</strong>omposed characters where possible, and defines a strict ordering
of diacritics if more than one exists. <abbr title="Normalization Form D (canonical decomposition)">NFD</abbr> <strong>D</strong>ecomposes characters where possible.<sup id="fnref:gory"><a class="footnote-ref" href="#fn:gory">1</a></sup></p>
<p>It doesn&rsquo;t matter what form you use as long as you are consistent; <abbr title="Normalization Form D (canonical decomposition)">NFD</abbr> is
faster in general (fewer codepoints) and <a href="http://stackoverflow.com/a/6163129/74496">tchrist</a> suggests running input
through <abbr title="Normalization Form D (canonical decomposition)">NFD</abbr> and output through <abbr title="Normalisation Form C (canonical decomposition + canonical composition)">NFC</abbr>.</p>
<p><strong>Compatibility decomposition</strong> also maps characters such as <span><span class="unichar" data-code="FB03" data-name="LATIN SMALL LIGATURE FFI" title="LATIN SMALL LIGATURE FFI (U+FB03)">ﬃ</span></span>, <span><span class="unichar" data-code="2168" data-name="ROMAN NUMERAL NINE" title="ROMAN NUMERAL NINE (U+2168)">Ⅸ</span></span>
and even <span><span class="unichar" data-code="2075" data-name="SUPERSCRIPT FIVE" title="SUPERSCRIPT FIVE (U+2075)">⁵</span></span> to &lsquo;ffi&rsquo;, &lsquo;IX&rsquo; and &lsquo;5&rsquo; respectively. This <abbr title="Normalization Form KC (compatibility decomposition + canonical composition)">NFKC</abbr> normalisation
helps when searching for text.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">Unicode::Normalize</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$norm</span> <span class="o">=</span> <span class="n">NFD</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
</code></pre></div>

<hr />
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s1">&#39;NFC&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</code></pre></div>

<hr />
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/ruby</span>
<span class="c1"># gem install unicode_utils</span>
<span class="nb">require</span> <span class="s2">&quot;unicode_utils/nfc&quot;</span>
<span class="n">norm</span> <span class="o">=</span> <span class="no">UnicodeUtils</span><span class="o">.</span><span class="n">nfc</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</code></pre></div>

<h2>Casefolding</h2>
<p>Casing is not so simple in the Unicode world:</p>
<ul>
<li>
<p>Some strings actually change length when they change case: <span><span class="unichar" data-code="00DF" data-name="LATIN SMALL LETTER SHARP S" title="LATIN SMALL LETTER SHARP S (U+00DF)">ß</span></span> uppercases
  to &lsquo;SS&rsquo;.</p>
</li>
<li>
<p><span><span class="unichar" data-code="017F" data-name="LATIN SMALL LETTER LONG S" title="LATIN SMALL LETTER LONG S (U+017F)">ſ</span><span> LATIN SMALL LETTER LONG S</span></span> should be seen as equal to &lsquo;s&rsquo; and &lsquo;S&rsquo; in case-insensitive comparisons.</p>
</li>
<li>
<p><span><span class="unichar" data-code="03A3" data-name="GREEK CAPITAL LETTER SIGMA" title="GREEK CAPITAL LETTER SIGMA (U+03A3)">Σ</span><span> GREEK CAPITAL LETTER SIGMA</span></span> has <em>two</em> lowercase forms: <span><span class="unichar" data-code="03C3" data-name="GREEK SMALL LETTER SIGMA" title="GREEK SMALL LETTER SIGMA (U+03C3)">σ</span></span> at the beginning or middle of the
  word, and <span><span class="unichar" data-code="03C2" data-name="GREEK SMALL LETTER FINAL SIGMA" title="GREEK SMALL LETTER FINAL SIGMA (U+03C2)">ς</span></span> at the end of a word.</p>
</li>
<li>
<p>Casing is <em>mostly</em> consistent across locales, but Turkish is an exception: it
  has both a <a href="https://en.wikipedia.org/wiki/Dotted_and_dotless_I">Dotted and dotless I</a>, in both lower and upper cases.</p>
</li>
</ul>
<p>To ensure your code handles these cases, and any new ones, Unicode provides a
<em>one-way</em> &lsquo;casefold&rsquo; operation that allows case-insensitive comparison:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">Unicode::CaseFold</span><span class="p">;</span>   <span class="c1"># or: use v5.16;</span>
<span class="nb">sort</span> <span class="p">{</span> <span class="n">fc</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="ow">cmp</span> <span class="n">fc</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">}</span> <span class="nv">@stuff</span><span class="p">;</span>
</code></pre></div>

<p>Casefolding does <em>not</em> include normalization, so do that too.</p>
<h2>Sorting</h2>
<p>Sorting (or <em>collation</em>) is <strong>locale specific</strong> and just as riddled with
pecularities as casing:</p>
<ul>
<li>
<p>German and Swedish both have &auml; and &ouml; but sort them differently - German
    treats them as variants of the same letters without umlauts (i.e. &lsquo;a<strong>ä</strong>bcdefghijklmno<strong>ö</strong>pqrstuvwxyz&rsquo;)
    whereas Swedish considers them new letters, and puts them at the end (&lsquo;abcdefghijklmnopqrstuvwxyz<strong>äö</strong>&rsquo;)</p>
<p>It&rsquo;s important that things are sorted in the order the user expects.</p>
</li>
<li>
<p>Sorting varies by application too; phonebooks are often sorted differently to book
    indices, for example.</p>
</li>
<li>
<p>For Chinese characters and other ideographs, there are many possible orders, e.g.
    pinyin (phonetic), by stroke count, etc.</p>
</li>
<li>
<p>Collations can be <em>tailored</em> based on user preferences, e.g. lower or upper-case first?</p>
</li>
</ul>
<p>It&rsquo;s not enough to just sort by binary comparison. And codepoints aren&rsquo;t generally in any
sensible order either. Fortunately Unicode specifies a <a href="https://www.unicode.org/reports/tr10/">Collation Algorithm</a>
that is immensely customisable, covers all the edge-cases, and does clever things to make
it reasonably fast. Here&rsquo;s an example:<sup id="fnref:locale"><a class="footnote-ref" href="#fn:locale">2</a></sup></p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">Unicode::Collate::Locale</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$collator</span> <span class="o">=</span> <span class="nn">Unicode::Collate::Locale</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="n">locale</span> <span class="o">=&gt;</span> <span class="s">&#39;DE&#39;</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">$collator</span><span class="o">-&gt;</span><span class="nb">sort</span><span class="p">(</span><span class="nv">@array</span><span class="p">);</span>
<span class="nv">$collator</span><span class="o">-&gt;</span><span class="ow">cmp</span><span class="p">(</span><span class="nv">$word</span><span class="p">,</span> <span class="nv">$another_word</span><span class="p">);</span>  <span class="c1"># -&gt; -1, 0 or 1</span>
</code></pre></div>

<p>The <abbr title="Unicode Collation Algorithm">UCA</abbr> can do other clever things, such as sort &lsquo;10&rsquo; after &lsquo;2&rsquo; numerically, or sort
the character &lsquo;?&rsquo; as if it was the string &lsquo;question mark&rsquo;.</p>
<h2>Encodings</h2>
<p>The big ones are <code>UTF-8</code>, <code>UTF-16</code> and <code>UTF-32</code>. Each one guarantees a reversible
mapping of almost every codepoint<sup id="fnref:every"><a class="footnote-ref" href="#fn:every">3</a></sup> to a byte sequence.</p>
<ul>
<li>
<p><strong>UTF-32</strong> is dead simple: each codepoint gets four bytes. Takes up tons of space,
  not recommended for interchange.</p>
</li>
<li>
<p><strong>UTF-8</strong> is very common the web. It&rsquo;s byte-oriented (no endianness issues),
  handles corruption well, is ASCII-compatible and takes up minimal space for text
  that is mostly ASCII (e.g. HTML).</p>
<ul>
<li>
<p>Code points between U+0800 and U+FFFF, which includes commonly used <abbr title="Chinese, Japanese, Korean and Vietnamese">CJKV</abbr>
  characters, will take up 3 bytes instead of 2. So UTF-16 may be more space
  efficient.</p>
</li>
<li>
<p>ASCII-compatibility is helpful to allow UTF-8 to stealth its way through
  scripts and processes that are not Unicode-aware. But if such a system tries to
  do anything with the data (casing, sub-strings, regex), that data may be
  corrupted.</p>
</li>
</ul>
</li>
<li>
<p><strong>UTF-16</strong> is used by Java, .NET and Windows. It uses 2 bytes (16-bit) to
  represent the most common 63K codepoints, and 4 bytes for the less common 1M
  codepoints (using two &lsquo;surrogate&rsquo; codepoints).</p>
<ul>
<li>
<p>Contrary to popular belief, UTF-16 is not a fixed-width encoding. But as
  long as it contains no surrogates, it can be treated as one, which can speed
  up string operations.</p>
</li>
<li>
<p>UTF-16 streams typically begin with <span><span class="unichar" data-code="FEFF" data-name="ZERO WIDTH NO-BREAK SPACE" title="ZERO WIDTH NO-BREAK SPACE (U+FEFF)">U+FEFF</span></span><sup id="fnref:bomnote"><a class="footnote-ref" href="#fn:bomnote">4</a></sup> to detect the endianness
  (byte order) of the stream. Otherwise, you can explicitly encode or decode
  via &lsquo;UTF-16BE&rsquo; or &lsquo;UTF-16LE&rsquo; to specify the endianness.</p>
</li>
</ul>
</li>
</ul>
<h2>Unicode and internationalised domain names</h2>
<p>International characters create a <a href="https://en.wikipedia.org/wiki/IDN_homograph_attack">big problem</a>
for domain names. Just as <span><span class="unichar" data-code="0049" data-name="LATIN CAPITAL LETTER I" title="LATIN CAPITAL LETTER I (U+0049)">I</span></span> and <span><span class="unichar" data-code="006C" data-name="LATIN SMALL LETTER L" title="LATIN SMALL LETTER L (U+006C)">l</span></span> look similar, Unicode multiplies that problem
by 1,000, in addition to adding numerous invisible control characters, spacing characters
and right-to-left text.</p>
<p>Browsers and registrars have implemented several measures against this:</p>
<ul>
<li>Many TLDs restrict which characters can be used in domain names.</li>
<li>Browsers may display the domain in Punycode (see below) if the domain includes characters
  from multiple scripts and/or characters not belonging to one of the user&rsquo;s preferred languages.</li>
<li>Internationalised country codes such as .рф (Russia) only accept Cyrillic names.</li>
</ul>
<h3>nameprep/stringprep</h3>
<p><a href="https://tools.ietf.org/html/rfc3491">RFC 3491</a> defines <em>nameprep</em>, a mechanism
to case-fold, normalize and sanitize strings before they can be used in domain names. This
removes many invisible characters and throws an error if prohibited code points are in use.</p>
<p>It is implemented in terms of a wider framework called <em>stringprep</em>. In Perl, one can use
<a href="https://metacpan.org/module/Net::IDN::Encode">Net::IDN::Encode</a> which will also perform Punycode conversion.</p>
<h3>Punycode</h3>
<p>For legacy reasons DNS does not allow extended characters outside of ASCII, so Punycode
is an ASCII-compatible encoding scheme. For example, <code>café.com</code> becomes <code>xn--caf-dma.com</code>.
All Punycode-encoded domain components are instantly recognisable by their <code>xn--</code> prefix.</p>
<p>This goes for TLDs too: .中国 is really known as <em>xn&ndash;fiqs8s</em>.</p>
<h2>The problem of &lsquo;user characters&rsquo;</h2>
<p>In Perl at least, everything (<code>substr</code>, <code>length</code>, <code>index</code>, <code>reverse</code>&hellip;) works on the level
of codepoints. This is often not what you want, because what a user considers to be a
character such as ў is actually two codepoints (<span><span class="unichar" data-code="0079" data-name="LATIN SMALL LETTER Y" title="LATIN SMALL LETTER Y (U+0079)">y</span></span> + <span><span class="unichar" data-code="0306" data-name="COMBINING BREVE" title="COMBINING BREVE (U+0306)">◌̆</span></span>). Here&rsquo;s a <a href="https://www.nntp.perl.org/group/perl.perl5.porters/2011/10/msg178687.html">really good
usenet post</a> on the subject.</p>
<p>Even seemingly innocuous things like <code>printf "%-10s", $str</code> breaks completely for combining characters,
double-width characters (e.g. Chinese/Japanese) or zero-width characters.</p>
<p>Fortunately Perl provides the <code>\X</code> regular expression metachar which matches exactly one
&lsquo;extended grapheme cluster&rsquo;, i.e. what a user would consider a character to be. A more robust
solution is to install <a href="https://metacpan.org/module/Unicode::GCString">Unicode::GCString</a>:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nn">Unicode::GCString</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Unicode::Normalize</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">utf8</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">open</span> <span class="sx">qw(:std :encoding(UTF-8))</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="n">NFD</span><span class="p">(</span><span class="s">&quot;crème brûlée&quot;</span><span class="p">);</span>  <span class="c1"># ensure combining marks get their own codepoint</span>
<span class="k">my</span> <span class="nv">$g</span> <span class="o">=</span> <span class="nn">Unicode::GCString</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="nv">$s</span><span class="p">);</span>

<span class="k">print</span> <span class="nv">$g</span><span class="o">-&gt;</span><span class="nb">length</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>       <span class="c1"># 12, not 15</span>
<span class="k">print</span> <span class="nb">reverse</span><span class="p">(</span><span class="nv">@$g</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>     <span class="c1"># &#39;eélûrb emèrc&#39;, not &#39;éel̂urb em̀erc&#39;</span>
<span class="k">print</span> <span class="nv">$g</span><span class="o">-&gt;</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>  <span class="c1"># &#39;crème&#39;, not &#39;crèm&#39;</span>
<span class="k">print</span> <span class="nv">$g</span><span class="o">-&gt;</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>  <span class="c1"># &#39;crè&#39;, not &#39;cre&#39;</span>

<span class="k">print</span> <span class="s">&quot;1234512345123451234512345|\n&quot;</span><span class="p">;</span>
<span class="nb">printf</span> <span class="s">&quot;%s%*s|\n&quot;</span><span class="p">,</span> <span class="nv">$g</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span> <span class="o">-</span> <span class="nv">$g</span><span class="o">-&gt;</span><span class="n">columns</span><span class="p">),</span> <span class="s">&#39;&#39;</span><span class="p">;</span>  <span class="c1"># 25 columns long (ᵔᴥᵔ)</span>

<span class="nb">printf</span> <span class="s">&quot;%-25s|\n&quot;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">;</span>                          <span class="c1"># 22 columns long (╯°□°）╯︵ ┻━┻</span>
</code></pre></div>

<h3>Line breaks</h3>
<p>Line breaking (or word wrapping) is another thing that becomes <a href="https://www.unicode.org/reports/tr14/">insanely complicated</a>
once Unicode is involved. You have to account for various non-breaking and breaking control
and spacing characters, punctuation in every language (e.g. <span><span class="unichar" data-code="00AB" data-name="LEFT-POINTING DOUBLE ANGLE QUOTATION MARK" title="LEFT-POINTING DOUBLE ANGLE QUOTATION MARK (U+00AB)">«</span></span> and <span><span class="unichar" data-code="00BB" data-name="RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK" title="RIGHT-POINTING DOUBLE ANGLE QUOTATION MARK (U+00BB)">»</span></span> quotes, or the
full stop or comma being used in numerics such as <code>2,140</code>) and the width of each character.</p>
<p>In Perl, this has all been handled for you - just use <a href="https://metacpan.org/module/Unicode::LineBreak">Unicode::LineBreak</a>.</p>
<h2>Regular expressions</h2>
<p>Some useful Perl regular expression syntax:</p>
<dl>
<dt><code>\R</code></dt>
<dd>Match any Unicode linebreak sequence (including <code>\n</code>, <code>\r\n</code> and six others)</dd>
<dt><code>\p</code>, <code>\P</code></dt>
<dd>Match any codepoint possessing (or not possessing) a Unicode property.</dd>
<dd>Common ones are <code>\pL</code> (Letter), <code>\pU</code> (Uppercase), <code>\pS</code> (Symbol), or even <code>\p{script=Latin}</code>,
<code>\p{East_Asian_Width=Wide}</code>, <code>\p{Numeric_Value=4}</code>.</dd>
<dd>See <a href="https://perldoc.perl.org/perluniprops.html">perluniprops</a> for a big list.</dd>
<dd>Built-in character classes such as <code>\w</code>, <code>\b</code>, <code>\s</code> and <code>\d</code> are Unicode-aware since Perl
5.6 (though you need to make sure your string or pattern has the <code>UTF8</code> flag on!) Disable this
with the <code>/a</code> flag (see <a href="https://perldoc.perl.org/perlre.html#Character-set-modifiers">perlre</a>).</dd>
<dt><code>\X</code></dt>
<dd>Match an extended grapheme cluster, which is basically a user-visible &lsquo;character&rsquo;.</dd>
<dd>Use it instead of <b><code>.</code></b> unless you want codepoints.</dd>
<dd>E.g. to match a vowel with optional diacritics or marks (<a href="https://www.perl.com/pub/2012/05/perlunicook-match-unicode-grapheme-cluster-in-regex.html">source</a>):<div class="codehilite"><pre><span></span><code><span class="k">my</span> <span class="nv">$nfd</span> <span class="o">=</span> <span class="n">NFD</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="nv">$nfd</span> <span class="o">=~</span><span class="sr"> / (?=[aeiou]) \X /xi</span><span class="p">;</span>
</code></pre></div>

</dd>
</dl>
<hr />
<h2>Trivia</h2>
<h3>Filesystems</h3>
<p>When you use Unicode strings as file or directory names, all bets are off. What encoding do you
use? What <em>API</em> do you use? (Windows has two, one speaks Unicode, the other tries to use locale-dependent
encodings). Some filesystems perform normalization such as <abbr title="Normalization Form D (canonical decomposition)">NFD</abbr> on file names, such as Mac OS X; this
may be an issue if your platform doesn&rsquo;t understand decomposed Unicode.</p>
<p>In summary, consult docs and test your assumptions.</p>
<h3>Han Unification</h3>
<p>Han characters are a common feature of Chinese, Japanese (kanji) and historical
Korean and Vietnamese.
Many have a distinct visual appearance depending on the script, but Unicode unifies
them as a single codepoint for simplicity and performance reasons (<a href="https://en.wikipedia.org/wiki/Han_unification#Examples_of_language_dependent_characters">examples</a>).</p>
<p>This caused controversy because the visual form of a character can be <em>meaningful</em>;
users may not be shown their national variant but rather some other country&rsquo;s version.
In some cases they can look very different (e.g. <span><span class="unichar" data-code="76F4" data-name="CJK UNIFIED IDEOGRAPH-76F4" title="CJK UNIFIED IDEOGRAPH-76F4 (U+76F4)">直</span></span>). Just as Western names vary
(e.g. &lsquo;John&rsquo; or &lsquo;Jon&rsquo;) Japanese names may use specific glyph variants that Unicode
does not provide, so people cannot actually write their own name the way they&rsquo;d prefer!</p>
<p>In practice, users select a typeface that renders glyphs in the style they want, be
that Japanese or Chinese. Variation Selectors (see below) are another solution to the
problem.</p>
<p>For political and legacy reasons (compatibility with older character sets), Unicode
does not attempt to unify simplified and traditional Chinese.</p>
<h3>Emoji</h3>
<p>Version 6.0 of Unicode adds 722 &lsquo;emoji&rsquo; characters, which are emoticons used
mostly on Japanese phones, but recently in Mac OS X (Lion), Gmail, iPhone and Windows
Phone 7. Some fonts may choose to render them as full-colour emoticons; some may not
support them at all.</p>
<p>Emoji is the reason why Unicode includes <span><span class="unichar" data-code="1F3E9" data-name="LOVE HOTEL" title="LOVE HOTEL (U+1F3E9)">🏩</span><span> LOVE HOTEL</span></span> and <span><span class="unichar" data-code="1F4A9" data-name="PILE OF POO" title="PILE OF POO (U+1F4A9)">💩</span><span> PILE OF POO</span></span>. (If you can&rsquo;t see
them, install <a href="https://users.teilar.gr/~g1951d/">Symbola</a>, or click the fileformat.info link for a picture).</p>
<h4>Regional Indicator symbols</h4>
<p style="text-align: center"><img alt="Regional indicator example (FR)" src="/static/images/regional-indicators.png" style="max-width: 352px" /></p>
<p>Unicode 6.0&rsquo;s emoji introduced symbols for many country flags,
but not all of them. As an alternative, the range <span><span class="unichar" data-code="1F1E6" data-name="REGIONAL INDICATOR SYMBOL LETTER A" title="REGIONAL INDICATOR SYMBOL LETTER A (U+1F1E6)">U+1F1E6</span></span>..<span><span class="unichar" data-code="1F1FF" data-name="REGIONAL INDICATOR SYMBOL LETTER Z" title="REGIONAL INDICATOR SYMBOL LETTER Z (U+1F1FF)">U+1F1FF</span></span>
defines symbols from A to Z. If two symbols from this range form an ISO-3166-1
country code (e.g. &lsquo;FR&rsquo; for France), the renderer may choose to display it
as a flag instead!</p>
<h3>Variation Selectors</h3>
<p>Variation Selectors are codepoints that change the way the character before
them is rendered. There are 256 and they occupy the ranges <span><span class="unichar" data-code="FE00" data-name="VARIATION SELECTOR-1" title="VARIATION SELECTOR-1 (U+FE00)">U+FE00</span></span>..<span><span class="unichar" data-code="FE0F" data-name="VARIATION SELECTOR-16" title="VARIATION SELECTOR-16 (U+FE0F)">U+FE0F</span></span>
and <span><span class="unichar" data-code="E0100" data-name="VARIATION SELECTOR-17" title="VARIATION SELECTOR-17 (U+E0100)">U+E0100</span></span>..<span><span class="unichar" data-code="E01EF" data-name="VARIATION SELECTOR-256" title="VARIATION SELECTOR-256 (U+E01EF)">U+E01EF</span></span> plus <span><span class="unichar" data-code="180B" data-name="MONGOLIAN FREE VARIATION SELECTOR ONE" title="MONGOLIAN FREE VARIATION SELECTOR ONE (U+180B)">U+180B</span></span>, <span><span class="unichar" data-code="180C" data-name="MONGOLIAN FREE VARIATION SELECTOR TWO" title="MONGOLIAN FREE VARIATION SELECTOR TWO (U+180C)">U+180C</span></span> and <span><span class="unichar" data-code="180D" data-name="MONGOLIAN FREE VARIATION SELECTOR THREE" title="MONGOLIAN FREE VARIATION SELECTOR THREE (U+180D)">U+180D</span></span>.</p>
<p>They are essential for the Mongolian script, which has different glyph forms
depending on its position in the word, the gender of the word, what letters
are nearby, whether or not the word is foreign, and modern vs. traditional
orthography (<a href="https://babelstone.blogspot.co.uk/2007/06/secret-life-of-variation-selectors.html">details</a>).</p>
<p>It is anticipated that these will be used to offer variations of glyphs
unified by Han Unification.</p>
<p>They are also used for somewhat more esoteric things, such as <a href="https://www.unicode.org/Public/6.0.0/ucd/StandardizedVariants.html">serif versions
of mathematical operators</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:gory">
<p>Gory details: <a href="https://www.macchiato.com/unicode/nfc-faq">http://www.macchiato.com/unicode/nfc-faq</a>.&#160;<a class="footnote-backref" href="#fnref:gory" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:locale">
<p>See <a href="https://metacpan.org/module/Unicode::Collate::Locale#A-list-of-tailorable-locales">Unicode::Collate::Locale</a> for a full list of locales.&#160;<a class="footnote-backref" href="#fnref:locale" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:every">
<p>Except surrogates.&#160;<a class="footnote-backref" href="#fnref:every" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:bomnote">
<p>Although it is called &lsquo;ZERO WIDTH NO-BREAK SPACE&rsquo;, it is more appropriate to use <span><span class="unichar" data-code="2060" data-name="WORD JOINER" title="WORD JOINER (U+2060)">U+2060</span><span> WORD JOINER</span></span>.&#160;<a class="footnote-backref" href="#fnref:bomnote" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</article>

</div>


<aside class="large-3 columns sidebar">
<div class="panel">
<h5>First time here?</h5>
<p>Have a look at my <a href="/featured/">featured articles</a>.</p>
</div>
<h5>Categories</h5>
<ul class="side-nav">

<li><a href="/category/Japanese/">Japanese</a></li>

<li><a href="/category/Programming/">Programming</a></li>

<li><a href="/category/Wellbeing/">Wellbeing</a></li>

</ul>
<h5>Tags</h5>
<ul class="side-nav taglist">

<li><a href="/tag/programming/" data-count="8">programming (8)</a></li>

<li><a href="/tag/japanese/" data-count="7">japanese (7)</a></li>

<li><a href="/tag/perl/" data-count="7">perl (7)</a></li>

<li><a href="/tag/featured/" data-count="4">featured (4)</a></li>

<li><a href="/tag/unicode/" data-count="2">unicode (2)</a></li>

<li><a href="/tag/pbp/" data-count="2">pbp (2)</a></li>

<li><a href="/tag/dart/" data-count="1">dart (1)</a></li>

<li><a href="/tag/problems/" data-count="1">problems (1)</a></li>

<li><a href="/tag/python/" data-count="1">python (1)</a></li>

<li><a href="/tag/wellbeing/" data-count="1">wellbeing (1)</a></li>

<li><a href="/tag/book-summary/" data-count="1">book-summary (1)</a></li>

<li><a href="/tag/productivity/" data-count="1">productivity (1)</a></li>

<li><a href="/tag/faq/" data-count="1">faq (1)</a></li>

<li><a href="/tag/gotcha/" data-count="1">gotcha (1)</a></li>

<li><a href="/tag/heatmap/" data-count="1">heatmap (1)</a></li>

<li><a href="/tag/cpan/" data-count="1">cpan (1)</a></li>

<li><a href="/tag/git/" data-count="1">git (1)</a></li>

<li><a href="/tag/datetime/" data-count="1">datetime (1)</a></li>

<li><a href="/tag/stackoverflow/" data-count="1">stackoverflow (1)</a></li>

</ul>
</a>
<h5>Other sites</h5>
<ul class="side-nav taglist">
<li><a href="https://github.com/richardjharris">GitHub</a></li>
</ul>
<div class="text-center">
<!-- stackoverflow badge. slow so lazy-load it -->
<a href="https://stackoverflow.com/users/74496/rjh">
<img id="stack" data-original="https://stackoverflow.com/users/flair/74496.png"
    width="208" height="58" alt="Link to stackoverflow profile"
    title="stackoverflow profile">
    <noscript>
    <img src="https://stackoverflow.com/users/flair/74496.png"
    width="208" height="58" alt="Link to stackoverflow profile"
    title="stackoverflow profile">
    </noscript>
</a>
<!-- end badge -->
</div>
</aside>

</div>

<footer class="row">
<div class="large-12 columns">
<hr/>
<div class="row">
<div class="large-6 columns">
<p>&copy; Richard Harris 2022.</p>
</div>
<div class="large-6 columns">
<p class="right">
Made with <a href="https://foundation.zurb.com/">Foundation</a> and <a href="https://flask.palletsprojects.com/en/2.1.x/">Flask</a>.
</p>
</div>
</div>
</div>
</footer>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/jquery.qtip.min.css" />
<script src="/static/js/vendor/jquery.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.1/basic/jquery.qtip.min.js"></script>
<script src="/static/js/unicode-tooltips.js"></script>
<script>
      $(document).ready(function(){
        $('.unichar').each(add_unicode_tooltip);
        $('.an').each(add_annotation_tooltip);
        // For debugging tooltip HTML
        // $('.an').each(function() { $(this).qtip('toggle', true); });

        $('#stack').attr('src', $('#stack').data('original'));
      });
    </script>
</body>
</html>